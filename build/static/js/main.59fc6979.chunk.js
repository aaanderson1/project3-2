(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(e,n,t){var a={"./grinning.png":35,"./neutral.png":36,"./rolling.png":37,"./slightly.png":38,"./sunglasses.png":39,"./thinking.png":40};function o(e){var n=i(e);return t(n)}function i(e){if(!t.o(a,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return a[e]}o.keys=function(){return Object.keys(a)},o.resolve=i,e.exports=o,o.id=19},30:function(e,n,t){e.exports=t(47)},35:function(e,n,t){e.exports=t.p+"static/media/grinning.a5c4c868.png"},36:function(e,n,t){e.exports=t.p+"static/media/neutral.a7fe3123.png"},37:function(e,n,t){e.exports=t.p+"static/media/rolling.8d0d9682.png"},38:function(e,n,t){e.exports=t.p+"static/media/slightly.f8af4936.png"},39:function(e,n,t){e.exports=t.p+"static/media/sunglasses.4238fe56.png"},40:function(e,n,t){e.exports=t.p+"static/media/thinking.872be34d.png"},47:function(e,n,t){"use strict";t.r(n);var a=t(0),o=t.n(a),i=t(25),r=t(17),s=t(15),c=t(8),l=t(9),u=t(12),h=t(11),p=t(13),g=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"shower_though_secret";Object(c.a)(this,e),this.tokenName=n,this.token=null,this.loadToken()}return Object(l.a)(e,[{key:"loadToken",value:function(){var e=window.localStorage.getItem(this.tokenName);if(e){var n=JSON.parse(e);if(n.token&&n.dateTimeString){var t=new Date(n.dateTimeString);new Date<t&&n.token&&(this.token=n.token)}}}},{key:"saveToken",value:function(e){this.token=e;var n=new Date;n.setMinutes(n.getMinutes()+60),window.localStorage.setItem(this.tokenName,JSON.stringify({token:this.token,dateTimeString:n.toISOString()}))}}]),e}(),m=function(e){function n(){return Object(c.a)(this,n),Object(u.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(p.a)(n,e),Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this,n=new g;null!==n.token?fetch("".concat(window.location.origin.toString(),"/api/anon/").concat(n.token)).then(function(e){return e.json()}).then(function(t){t.length>0&&t[0]._id===n.token?(console.log(t),e.props.history.push("messages")):e.props.history.push("login")}):this.props.history.push("login")}},{key:"render",value:function(){return o.a.createElement("div",null)}}]),n}(o.a.Component),d=t(16),f=t(48),v=t(52),k=["grinning","neutral","rolling","slightly","sunglasses","thinking"],y=function(e){function n(e){var t;return Object(c.a)(this,n),(t=Object(u.a)(this,Object(h.a)(n).call(this,e))).state={avatar:k[Math.floor(Math.random()*k.length)]},t.login=t.login.bind(Object(d.a)(t)),t}return Object(p.a)(n,e),Object(l.a)(n,[{key:"componentDidMount",value:function(){null===(new g).token||this.props.onComplete()}},{key:"login",value:function(){var e=this;return fetch("".concat(window.location.origin.toString(),"/api/anon"),{method:"POST",body:JSON.stringify(this.state),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(n){console.log(n),(new g).saveToken(n._id),e.props.onComplete()}).catch(function(n){e.props.onComplete(n)})}},{key:"render",value:function(){var e=this,n=t(19)("./".concat(this.state.avatar,".png"));return o.a.createElement("div",null,o.a.createElement(f.a,{src:n,roundedCircle:!0}),o.a.createElement(v.a,{variant:"outline-primary",onClick:function(){return e.login()}},"Login"))}}]),n}(o.a.Component),w=function(e){function n(){return Object(c.a)(this,n),Object(u.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(p.a)(n,e),Object(l.a)(n,[{key:"componentDidMount",value:function(){null===(new g).token||this.props.history.push("/")}},{key:"onComplete",value:function(e){e&&(console.log(e),(new g).saveToken(null));this.props.history.push("/")}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(y,{onComplete:this.onComplete.bind(this)}))}}]),n}(o.a.Component),E=t(51),b=function(e){function n(){return Object(c.a)(this,n),Object(u.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(p.a)(n,e),Object(l.a)(n,[{key:"render",value:function(){var e=this,n=t(19)("./".concat(this.props.message.mood,".png"));return o.a.createElement("div",null,o.a.createElement(E.a,null,o.a.createElement(E.a.Body,null,o.a.createElement(f.a,{src:n,roundedCircle:!0}),this.props.message.message,this.props.owned&&o.a.createElement(v.a,{variant:"outline-primary",onClick:function(){return e.props.deleteCallback(e.props.message._id)}},"X"))))}}]),n}(o.a.Component),O=t(49),j=t(50),C=t(53),S=function(e){function n(e){var t;return Object(c.a)(this,n),(t=Object(u.a)(this,Object(h.a)(n).call(this,e))).state={messages:[],anon:{_id:"???????",avatar:"haha"},loading:!0},t}return Object(p.a)(n,e),Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this,n=new g;null!==n.token?this.login(n.token).then(function(){return e.getMessages()}):this.props.history.push("/")}},{key:"login",value:function(e){var n=this;return fetch("".concat(window.location.origin.toString(),"/api/anon/").concat(e)).then(function(e){return e.json()}).then(function(t){t.length>0&&t[0]._id===e?(console.log(t),n.setState({anon:t[0]})):((new g).saveToken(null),n.props.history.push("/"))}).catch(function(e){(new g).saveToken(null),n.props.history.push("/")})}},{key:"getMessages",value:function(){var e=this;return fetch("".concat(window.location.origin.toString(),"/api/messages")).then(function(e){return e.json()}).then(function(n){n=n.reverse(),console.log(n),e.setState({anon:e.state.anon,messages:n,loading:!1})})}},{key:"handleKeyPress",value:function(e){var n=this;if(13===e.charCode){var t=e.target.value;return e.target.value="",console.log(t),fetch("".concat(window.location.origin.toString(),"/api/message"),{method:"POST",body:JSON.stringify({message:t,anon:this.state.anon._id,mood:this.state.anon.avatar}),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){n.getMessages()}).catch(function(e){console.log(e)})}}},{key:"deleteMessage",value:function(e){var n=this;return fetch("".concat(window.location.origin.toString(),"/api/message/").concat(e,"/").concat(this.state.anon._id),{method:"DELETE"}).then(function(e){return e.json()}).then(function(e){n.getMessages()}).catch(function(e){console.log(e)})}},{key:"render",value:function(){var e=this;if(this.state.loading)return o.a.createElement("div",null,o.a.createElement(O.a,{animation:"grow",variant:"primary"}),o.a.createElement(O.a,{animation:"grow",variant:"secondary"}),o.a.createElement(O.a,{animation:"grow",variant:"success"}),o.a.createElement(O.a,{animation:"grow",variant:"danger"}),o.a.createElement(O.a,{animation:"grow",variant:"warning"}),o.a.createElement(O.a,{animation:"grow",variant:"info"}),o.a.createElement(O.a,{animation:"grow",variant:"light"}),o.a.createElement(O.a,{animation:"grow",variant:"dark"}));var n=t(19)("./".concat(this.state.anon.avatar,".png"));return o.a.createElement("div",null,o.a.createElement(E.a,null,o.a.createElement(E.a.Body,null,o.a.createElement(f.a,{src:n,roundedCircle:!0}),o.a.createElement(E.a,null,o.a.createElement(E.a.Body,null,o.a.createElement(j.a,{onKeyPress:this.handleKeyPress.bind(this),className:"mb-3"},o.a.createElement(j.a.Prepend,null,o.a.createElement(j.a.Text,{id:"inputGroup-sizing-default"},"What's on your mind?")),o.a.createElement(C.a,{"aria-label":"Default","aria-describedby":"inputGroup-sizing-default"})))))),this.state.messages.map(function(n){return o.a.createElement(b,{message:n,deleteCallback:e.deleteMessage.bind(e),owned:e.state.anon._id===n.anon})}))}}]),n}(o.a.Component),T=function(){return o.a.createElement("main",null,o.a.createElement(r.a,null,o.a.createElement(s.c,null,o.a.createElement(s.a,{exact:!0,path:"/",component:m}),o.a.createElement(s.a,{path:"/login",component:w}),o.a.createElement(s.a,{path:"/messages",component:S}))))},M=function(){return o.a.createElement("div",null,o.a.createElement(T,null))};Object(i.render)(o.a.createElement(r.a,null,o.a.createElement(M,null)),document.getElementById("root"))}},[[30,1,2]]]);
//# sourceMappingURL=main.59fc6979.chunk.js.map